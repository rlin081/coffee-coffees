<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>☕ Super Awesome Coffee Predictor</title>
  <style>
    :root{
      --bg:#ffffff; --card:#ffffff; --ink:#14161a; --muted:#5b6572; --accent:#2563eb; --accent2:#7c3aed; --good:#047857; --warn:#b45309;
      --line:#e6e9ee; --soft:#f5f7fb;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; background:var(--bg); color:var(--ink); display:grid; place-items:center; padding:28px}
    .app{width:100%; max-width:820px}
    .card{background:var(--card); border:1px solid var(--line); border-radius:18px; padding:22px 20px; box-shadow:0 8px 30px rgba(9,12,16,.06)}
    h1{margin:0 0 6px; font-size:clamp(24px,3.5vw,40px); text-align:center; color:var(--accent2)}
    .subtitle{color:var(--muted); margin:4px 0 18px; text-align:center}

    .row{display:grid; grid-template-columns:1fr auto; gap:12px; align-items:center}
    .input{background:#fff; border:1px solid var(--line); padding:14px 16px; border-radius:14px; color:var(--ink); outline:none; width:100%; font-size:16px}
    .input:focus{border-color:var(--accent); box-shadow:0 0 0 4px rgba(37,99,235,.12)}
    .btn{border:0; background:linear-gradient(90deg,var(--accent),var(--accent2)); color:#fff; padding:12px 16px; border-radius:12px; font-weight:700; cursor:pointer; transition:transform .05s ease}
    .btn:active{transform:translateY(1px)}
    .tiny{font-size:12px; color:var(--muted)}
    .switch{display:inline-flex; align-items:center; gap:10px}
    .toggle{appearance:none; width:48px; height:28px; background:#e9eef7; border-radius:999px; position:relative; outline:none; cursor:pointer; transition:background .2s ease; border:1px solid var(--line)}
    .toggle::after{content:""; position:absolute; top:3px; left:3px; width:22px; height:22px; background:#fff; border-radius:50%; box-shadow:0 1px 2px rgba(0,0,0,.12); transition:transform .2s ease}
    .toggle:checked{background:#bbf7d0}
    .toggle:checked::after{transform:translateX(20px)}

    .result{margin-top:16px; padding:16px; border:1px solid var(--line); border-radius:16px; background:var(--soft); display:grid; gap:10px}
    .result[hidden]{display:none}
    .badge{display:inline-block; padding:4px 8px; border-radius:999px; background:#eef2ff; border:1px solid #e0e7ff; color:#3730a3; font-size:12px}

    .analysis{min-height:40px; white-space:pre-wrap; line-height:1.5}
    .bars{display:grid; gap:10px; margin-top:4px}
    .bar{height:12px; background:#eef2f7; border:1px solid var(--line); border-radius:999px; overflow:hidden}
    .bar>span{display:block; height:100%; background:linear-gradient(90deg,var(--accent),var(--accent2)); width:0%; transition:width .6s cubic-bezier(.2,.7,.2,1)}
    .winner{color:var(--good); font-weight:800; text-align:center; font-size:18px}

    .history{margin-top:16px}
    .history ul{list-style:none; padding:0; margin:8px 0 0; display:grid; gap:8px}
    .history li{background:#fff; border:1px solid var(--line); padding:10px 12px; border-radius:10px; color:#334155; font-size:13px; display:grid; grid-template-columns:1fr auto; gap:8px; align-items:center}
    .history .pill{font-size:11px; padding:2px 8px; border-radius:999px; background:#f1f5f9; border:1px solid var(--line); color:#475569}

    .confetti{position:fixed; inset:0; pointer-events:none}
    .sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}
    .footer{margin-top:14px; color:var(--muted); font-size:12px; text-align:center}
    .easter{color:var(--warn); cursor:help; text-decoration:underline dotted}
  </style>
</head>
<body>
  <div class="app" role="application" aria-labelledby="title">
    <div class="card" aria-live="polite">
      <h1 id="title">☕ Super Awesome Coffee Predictor</h1>
      <p class="subtitle">Predict your perfect drink. Transparency note: we add a tiny <em>espresso prior</em> because productivity is funny.</p>

      <div class="row" style="margin-bottom:12px">
        <label for="mood" class="sr-only">Describe your mood</label>
        <input id="mood" class="input" placeholder="Describe your vibe… e.g., ‘deadline panic but kinda hopeful’" aria-describedby="hint" />
        <button id="go" class="btn" aria-label="Get coffee recommendation">Recommend ☕</button>
      </div>
      <div class="row" style="margin-bottom:8px">
        <div class="switch">
          <input id="serious" type="checkbox" class="toggle" role="switch" aria-checked="false" aria-label="Serious mode" />
          <span class="tiny">Serious Mode (removes espresso bias)
            <span class="easter" title="Why would you ever do that?">(controversial)</span>
          </span>
        </div>
        <span class="tiny" id="hint">Tip: press Enter to submit. Bias disclosure: +1 espresso.</span>
      </div>

      <div id="result" class="result" hidden>
        <div>
          <span class="badge" id="badge">espresso-biased</span>
        </div>
        <div id="winner" class="winner">Coffee: Espresso</div>
        <div id="analysis" class="analysis"></div>
        <div>
          <div class="tiny" style="margin-bottom:6px">Class scores</div>
          <div class="bars" id="bars"></div>
        </div>
      </div>

      <div class="history" aria-label="Previous vibes">
        <div class="tiny">Vibe streak: <span id="streak">0</span> • Recent inputs</div>
        <ul id="hist"></ul>
      </div>

      <canvas id="confetti" class="confetti"></canvas>
      <div class="footer">Model card: tiny lexicon + disclosed prior. Limitations: occasionally recommends espresso.</div>
    </div>
  </div>

  <script>
    // ——— tiny rule-based model with an espresso prior ———
    const LEX = {
      espresso: { tired:3, exhausted:3, deadline:3, focus:2, panic:2, cram:2, study:2, finals:3, morning:2, sprint:2, grind:2 },
      latte:    { cozy:3, relaxed:2, calm:2, book:2, blanket:2, rainy:2, mellow:2, brunch:2 },
      mocha:    { treat:2, sweet:2, dessert:2, reward:2, comfort:2 },
      coldbrew: { hyped:2, excited:2, heat:2, summer:2, sunny:2, refreshing:2, outside:2 }
    };

    function tokenize(t){ return (t.toLowerCase().match(/[a-z']+/g) || []); }

    function score(text, serious=false){
      const tokens = tokenize(text);
      const scores = { espresso: serious?0:1, latte:0, mocha:0, coldbrew:0 }; // espresso prior +1 unless serious
      for (const tok of tokens){
        for (const drink in LEX){ if (LEX[drink][tok]) scores[drink] += LEX[drink][tok]; }
      }
      const base = 0.0001; for (const k in scores) scores[k]+=base; // never 0 for the chart
      return scores;
    }

    // ——— UI refs ———
    const $ = s=>document.querySelector(s);
    const mood = $('#mood');
    const go = $('#go');
    const serious = $('#serious');
    const res = $('#result');
    const badge = $('#badge');
    const winner = $('#winner');
    const analysis = $('#analysis');
    const bars = $('#bars');
    const hist = $('#hist');
    const streak = $('#streak');

    // history
    const KEY = 'espresso-moods-v2';
    function loadHist(){ return JSON.parse(localStorage.getItem(KEY)||'[]'); }
    function saveHist(arr){ localStorage.setItem(KEY, JSON.stringify(arr.slice(-6))); }
    function renderHist(){
      const arr = loadHist();
      streak.textContent = arr.length;
      hist.innerHTML = arr.map(x=>`<li><span>${escapeHTML(x.t)}</span><span class="pill">→ ${x.d}</span></li>`).join('');
    }

    function escapeHTML(s){return s.replace(/[&<>"']/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;"}[c]));}

    const QUIPS = [
      t=>`Ran FFT on your vibe and found high-frequency chaos. Recommendation: espresso.`,
      t=>`Bayesian prior strongly favors productivity juice. Posterior says: espresso.`,
      t=>`Identified token ‘${(tokenize(t)[0]||'silence') }’. Classic espresso trigger.`,
      t=>`Applied fairness audit. Found systemic bias toward espresso. We kept it.`,
      t=>`kNN on vibespace ⇒ nearest neighbor: ‘deadline’. Class: espresso.`
    ];

    function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

    function typewriter(node, text){
      node.textContent = '';
      let i=0; const iv = setInterval(()=>{ node.textContent += text[i++]; if(i>=text.length) clearInterval(iv); }, 12);
    }

    function renderBars(scores){
      const total = Object.values(scores).reduce((a,b)=>a+b,0);
      const ordered = Object.entries(scores).sort((a,b)=>b[1]-a[1]);
      bars.innerHTML = ordered.map(([k,v])=>{
        const pct = Math.max(4, Math.round(100*(v/total)));
        return `<div><div class="tiny" style="margin-bottom:4px">${k} — ${pct}%</div><div class="bar" aria-label="${k} score"><span style="width:${pct}%"></span></div></div>`;
      }).join('');
      return ordered[0][0];
    }

    function recommend(){
      const text = mood.value.trim() || '(silence)';
      const sMode = serious.checked;
      const scores = score(text, sMode);
      const top = renderBars(scores);
      res.hidden = false;
      badge.textContent = sMode ? 'unbiased' : 'espresso-biased';
      winner.textContent = 'Coffee: ' + (top[0].toUpperCase()+top.slice(1));
      const quip = pick(QUIPS)(text);
      typewriter(analysis, `${quip}\n\nInput: \"${text}\"\nSerious mode: ${sMode ? 'ON' : 'OFF'}`);

      const arr = loadHist();
      arr.push({ t: text, d: top });
      saveHist(arr);
      renderHist();

      if (top === 'espresso' && !sMode) celebrate();
    }

    // ——— confetti ———
    const confettiCanvas = document.getElementById('confetti');
    const ctx = confettiCanvas.getContext('2d');
    function resize(){ confettiCanvas.width = innerWidth; confettiCanvas.height = innerHeight; }
    addEventListener('resize', resize); resize();

    let confettiPieces = [];
    function celebrate(){
      const N = 120;
      for (let i=0;i<N;i++){
        confettiPieces.push({
          x: Math.random()*innerWidth,
          y: -10 - Math.random()*40,
          vx: (Math.random()-0.5)*2,
          vy: 2 + Math.random()*2,
          size: 3+Math.random()*4,
          rot: Math.random()*Math.PI,
          vr: (Math.random()-0.5)*0.2,
          alpha: 1
        });
      }
      if (!animating) requestAnimationFrame(tick);
    }

    let animating=false;
    function tick(){
      animating=true;
      ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
      confettiPieces = confettiPieces.filter(p=>p.y<innerHeight+20 && p.alpha>0.05);
      for (const p of confettiPieces){
        p.x += p.vx; p.y += p.vy; p.rot += p.vr; p.alpha *= 0.993;
        ctx.save();
        ctx.globalAlpha = p.alpha;
        ctx.translate(p.x, p.y); ctx.rotate(p.rot);
        ctx.fillStyle = `hsl(${(p.x+p.y)%360} 80% 55%)`;
        ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size);
        ctx.restore();
      }
      if (confettiPieces.length>0) requestAnimationFrame(tick); else animating=false;
    }

    // events & a11y
    go.addEventListener('click', recommend);
    mood.addEventListener('keydown', e=>{ if(e.key==='Enter') recommend(); });
    serious.addEventListener('change', ()=>{ serious.setAttribute('aria-checked', serious.checked?'true':'false'); });

    // preload
    renderHist();
    setTimeout(()=>{ mood.value = 'deadline panic but kind of hopeful'; }, 300);
  </script>
</body>
</html>
